# Kittygram Infrastructure and Deployment

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∫–æ–¥ –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ [Kittygram](https://github.com/yandex-praktikum/kittygram) –≤ Yandex Cloud.

## üìö –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–í —Ä–∞–º–∫–∞—Ö –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Kittygram –≤ –æ–±–ª–∞–∫–µ Yandex Cloud. –î–ª—è —ç—Ç–æ–≥–æ –±—ã–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Terraform: —Å–æ–∑–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞, –ø—É–±–ª–∏—á–Ω—ã–π IP-–∞–¥—Ä–µ—Å, –æ–±–ª–∞—á–Ω–∞—è —Å–µ—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SSH-–¥–æ—Å—Ç—É–ø–∞. –ù–∞ —ç—Ç–∞–ø–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –í–ú –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è cloud-init, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ docker-compose –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ SSH-–∫–ª—é—á–µ–π.

–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ GitHub Actions. –°–æ–∑–¥–∞–Ω CI/CD-–ø–∞–π–ø–ª–∞–π–Ω, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–∞–¥–∏–π: —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, –±—ç–∫–µ–Ω–¥–∞ –∏ nginx, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∏—Ö –Ω–∞ DockerHub, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞—á–Ω–æ–π –í–ú –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º docker-compose.production.yml. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã Telegram-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –ø–∞–π–ø–ª–∞–π–Ω–∞. –î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—é –æ–±—Ä–∞–∑–æ–≤ –≤ DockerHub. –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é.

## üì¶ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- [Terraform](https://www.terraform.io/) ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥
- [GitHub Actions](https://docs.github.com/en/actions) ‚Äî CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã
- [Docker](https://www.docker.com/) ‚Äî —É–ø–∞–∫–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [Yandex Cloud](https://cloud.yandex.ru/) ‚Äî –æ–±–ª–∞—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- [cloud-init](https://cloudinit.readthedocs.io/en/latest/) ‚Äî –ø–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –í–ú
- [Telegram Bot](https://core.telegram.org/bots/api) ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## ‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ README.md  
‚îú‚îÄ‚îÄ .github
‚îÇ   ‚îî‚îÄ‚îÄ workflows
‚îÇ       ‚îú‚îÄ‚îÄ deploy.yml              # GitHub Actions: –ø–∞–π–ø–ª–∞–π–Ω –¥–µ–ø–ª–æ—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—É—é –í–ú
‚îÇ       ‚îî‚îÄ‚îÄ terraform.yml           # GitHub Actions: –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Terraform-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ backend                         # Django-–±—ç–∫–µ–Ω–¥ Kittygram 
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ cats
‚îÇ   ‚îú‚îÄ‚îÄ entrypoint.sh
‚îÇ   ‚îú‚îÄ‚îÄ kittygram_backend
‚îÇ   ‚îú‚îÄ‚îÄ manage.py
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docker-compose.production.yml   # Compose-—Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–¥-—Å–±–æ—Ä–∫–∏ (frontend + backend + nginx)
‚îú‚îÄ‚îÄ frontend                        # React-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ Kittygram
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îú‚îÄ‚îÄ package-lock.json
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ public
‚îÇ   ‚îî‚îÄ‚îÄ src
‚îú‚îÄ‚îÄ infra                           # Terraform-–∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ Yandex Cloud
‚îÇ   ‚îú‚îÄ‚îÄ main.tf                     # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª: —Å–æ–∑–¥–∞—ë—Ç –í–ú, —Å–µ—Ç—å, –¥–∏—Å–∫ –∏ –ø—Ä–∏–≤—è–∑–∫—É –∫–ª—é—á–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ output.tf                   # –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Terraform
‚îÇ   ‚îú‚îÄ‚îÄ provider.tf                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Yandex Cloud
‚îÇ   ‚îî‚îÄ‚îÄ variables.tf                # –û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Terraform
‚îú‚îÄ‚îÄ nginx                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è reverse-proxy Nginx
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ pytest.ini
‚îú‚îÄ‚îÄ .env                            # –§–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –°–º–æ—Ç—Ä–∏ .env.example
‚îú‚îÄ‚îÄ tests
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îú‚îÄ‚îÄ test_connection.py
‚îÇ   ‚îú‚îÄ‚îÄ test_dockerhub_images.py
‚îÇ   ‚îî‚îÄ‚îÄ test_files.py
‚îî‚îÄ‚îÄ tests.yml
```

## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

| –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------------|----------|
| YC_SA_JSON_CREDENTIALS | JSON-—Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Yandex Cloud |
| YC_FOLDER_ID | ID –∫–∞—Ç–∞–ª–æ–≥–∞ Yandex Cloud |
| YC_CLOUD_ID | ID –æ–±–ª–∞–∫–∞ Yandex Cloud |
| TELEGRAM_CHAT_ID | ID —á–∞—Ç–∞ Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| TELEGRAM_BOT_TOKEN | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
| ACCESS_KEY | –î–æ—Å—Ç—É–ø –∫ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É |
| SECRET_KEY | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É |
| DOCKER_PASSWORD | –ü–∞—Ä–æ–ª—å –æ—Ç Docker Hub |
| DOCKER_USERNAME | –õ–æ–≥–∏–Ω –æ—Ç Docker Hub |
| PRODUCTION_HOST_ADDR | IP-–∞–¥—Ä–µ—Å –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| PRODUCTION_HOST_LOGIN | –õ–æ–≥–∏–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä—É |
| PRODUCTION_HOST_SSH_PRIVATE_KEY | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH-–∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä—É. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Deploy Action. |
| PRODUCTION_HOST_SSH_PUBLIC_KEY | –ü—É–±–ª–∏—á–Ω—ã–π SSH-–∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä—É. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–π. |
| ALLOWED_HOSTS | –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤ –¥–ª—è Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. |
| DEBUG | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ Django-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. |
| POSTGRES_PASSWORD | –ü–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL. |
| POSTGRES_USER | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è PostgreSQL. |
| POSTGRES_DB | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è PostgreSQL. |
| POSTGRES_HOST | –ê–¥—Ä–µ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL. |
| POSTGRES_PORT | –ü–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è PostgreSQL. |


## üöÄ Pipelines

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `terraform.yml`

–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ GitHub Actions ‚Üí Terraform. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤  Run workflow ‚Üí –≤—ã–±—Ä–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ:
 - plan ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π
 - apply ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã
 - destroy ‚Äî —É–¥–∞–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ apply —É —Ç–µ–±—è –ø–æ—è–≤–∏—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å Docker –∏ docker-compose –∏–∑ cloud-init.

### CI/CD `deploy.yml`

–ü–∞–π–ø–ª–∞–π–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É main/master

Stages
- –°–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–æ–≤ frontend, backend –∏ nginx
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ frontend, backend –∏ nginx
- –ü—É–±–ª–∏–∫–∞—Ü–∏—é –æ–±—Ä–∞–∑–æ–≤ –Ω–∞ DockerHub
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–π –í–ú
- –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é docker-compose.production.yml
- –ü—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

## –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã DevOps-–∏–Ω–∂–µ–Ω–µ—Ä –æ—Ç –Ø–Ω–¥–µ–∫—Å –ü—Ä–∞–∫—Ç–∏–∫—É–º–∞.
